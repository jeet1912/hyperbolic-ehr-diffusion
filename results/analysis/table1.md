Using device: mps
[MIMIC] Loading data/mimic_hf_cohort.pkl ...
[MIMIC] Patients: 7397 | Vocab size: 4817
[Rect-GD] Real trajectory stats: {
  "patients": 7397,
  "avg_visits_per_patient": 1.7,
  "avg_codes_per_visit": 424.04,
  "max_visits": 12,
  "max_codes": 9261
}
[Pretrain] Epoch 01 | train=0.0036 | val=0.0033
[Pretrain] Epoch 02 | train=0.0033 | val=0.0031
[Pretrain] Epoch 03 | train=0.0031 | val=0.0029
[Pretrain] Epoch 04 | train=0.0029 | val=0.0027
[Pretrain] Epoch 05 | train=0.0027 | val=0.0026
[Pretrain] Epoch 06 | train=0.0026 | val=0.0025
[Pretrain] Epoch 07 | train=0.0025 | val=0.0024
[Pretrain] Epoch 08 | train=0.0024 | val=0.0023
[Pretrain] Epoch 09 | train=0.0023 | val=0.0023
[Pretrain] Epoch 10 | train=0.0023 | val=0.0022
[Pretrain] Epoch 11 | train=0.0022 | val=0.0022
[Pretrain] Epoch 12 | train=0.0022 | val=0.0022
[Pretrain] Epoch 13 | train=0.0022 | val=0.0022
[Pretrain] Epoch 14 | train=0.0022 | val=0.0022
[Pretrain] Epoch 15 | train=0.0022 | val=0.0022
[Pretrain] Epoch 16 | train=0.0022 | val=0.0022
[Pretrain] Epoch 17 | train=0.0022 | val=0.0022
[Pretrain] Epoch 18 | train=0.0022 | val=0.0021
[Pretrain] Epoch 19 | train=0.0022 | val=0.0021
[Pretrain] Epoch 20 | train=0.0021 | val=0.0021
[Pretrain] Epoch 21 | train=0.0021 | val=0.0021
[Pretrain] Epoch 22 | train=0.0021 | val=0.0021
[Pretrain] Epoch 23 | train=0.0021 | val=0.0021
[Pretrain] Epoch 24 | train=0.0021 | val=0.0021
[Pretrain] Epoch 25 | train=0.0021 | val=0.0021
[Pretrain] Epoch 26 | train=0.0021 | val=0.0021
[Pretrain] Epoch 27 | train=0.0021 | val=0.0021
[Pretrain] Epoch 28 | train=0.0021 | val=0.0021
[Pretrain] Epoch 29 | train=0.0021 | val=0.0021
[Pretrain] Epoch 30 | train=0.0021 | val=0.0021
[Rect-GD] Diffusion/embedding correlation after pretraining: 0.8537
[Rect-GD] Epoch 001 | Train 19.1230 | Val 16.6052
[Rect-GD] Epoch 002 | Train 16.8545 | Val 16.2407
[Rect-GD] Epoch 003 | Train 16.3559 | Val 15.4633
[Rect-GD] Epoch 004 | Train 15.6138 | Val 14.6590
[Rect-GD] Epoch 005 | Train 14.9102 | Val 13.9005
[Rect-GD] Epoch 006 | Train 14.3290 | Val 13.3008
[Rect-GD] Epoch 007 | Train 13.8451 | Val 12.8020
[Rect-GD] Epoch 008 | Train 13.4081 | Val 12.3977
[Rect-GD] Epoch 009 | Train 13.0641 | Val 12.0497
[Rect-GD] Epoch 010 | Train 12.7268 | Val 11.7134
[Rect-GD] Epoch 011 | Train 12.4495 | Val 11.4092
[Rect-GD] Epoch 012 | Train 12.1789 | Val 11.0490
[Rect-GD] Epoch 013 | Train 11.9400 | Val 10.9403
[Rect-GD] Epoch 014 | Train 11.7055 | Val 10.5101
[Rect-GD] Epoch 015 | Train 11.4848 | Val 10.3704
[Rect-GD] Epoch 016 | Train 11.3304 | Val 10.1475
[Rect-GD] Epoch 017 | Train 11.1615 | Val 9.9473
[Rect-GD] Epoch 018 | Train 10.9910 | Val 9.8409
[Rect-GD] Epoch 019 | Train 10.8404 | Val 9.7539
[Rect-GD] Epoch 020 | Train 10.7203 | Val 9.5532
[Rect-GD] Epoch 021 | Train 10.6011 | Val 9.4688
[Rect-GD] Epoch 022 | Train 10.4621 | Val 9.3323
[Rect-GD] Epoch 023 | Train 10.3479 | Val 9.1923
[Rect-GD] Epoch 024 | Train 10.2352 | Val 9.0988
[Rect-GD] Epoch 025 | Train 10.1577 | Val 9.0193
[Rect-GD] Epoch 026 | Train 10.1318 | Val 8.8938
[Rect-GD] Epoch 027 | Train 10.0459 | Val 8.8880
[Rect-GD] Epoch 028 | Train 9.9605 | Val 8.7727
[Rect-GD] Epoch 029 | Train 9.8682 | Val 8.7324
[Rect-GD] Epoch 030 | Train 9.7828 | Val 8.6182
[Rect-GD] Epoch 031 | Train 9.7427 | Val 8.6366
[Rect-GD] Epoch 032 | Train 9.6464 | Val 8.5351
[Rect-GD] Epoch 033 | Train 9.6241 | Val 8.4923
[Rect-GD] Epoch 034 | Train 9.5520 | Val 8.4124
[Rect-GD] Epoch 035 | Train 9.4804 | Val 8.3481
[Rect-GD] Epoch 036 | Train 9.3980 | Val 8.3910
[Rect-GD] Epoch 037 | Train 9.4062 | Val 8.2058
[Rect-GD] Epoch 038 | Train 9.3834 | Val 8.1578
[Rect-GD] Epoch 039 | Train 9.2995 | Val 8.2446
[Rect-GD] Epoch 040 | Train 9.2582 | Val 8.1895
[Rect-GD] Epoch 041 | Train 9.2291 | Val 8.0947
[Rect-GD] Epoch 042 | Train 9.1920 | Val 8.1472
[Rect-GD] Epoch 043 | Train 9.1435 | Val 8.0015
[Rect-GD] Epoch 044 | Train 9.0883 | Val 8.0848
[Rect-GD] Epoch 045 | Train 9.0975 | Val 7.9992
[Rect-GD] Epoch 046 | Train 9.0689 | Val 8.0454
[Rect-GD] Epoch 047 | Train 9.0466 | Val 7.9618
[Rect-GD] Epoch 048 | Train 9.0299 | Val 7.9219
[Rect-GD] Epoch 049 | Train 9.0164 | Val 7.9601
[Rect-GD] Epoch 050 | Train 9.0125 | Val 7.8930
[Rect-GD] Epoch 051 | Train 8.9889 | Val 7.9106
[Rect-GD] Epoch 052 | Train 8.9449 | Val 7.9420
[Rect-GD] Epoch 053 | Train 8.9554 | Val 7.8988
[Rect-GD] Epoch 054 | Train 8.9432 | Val 7.8758
[Rect-GD] Epoch 055 | Train 8.9021 | Val 7.8090
[Rect-GD] Epoch 056 | Train 8.9162 | Val 7.8027
[Rect-GD] Epoch 057 | Train 8.8843 | Val 7.7752
[Rect-GD] Epoch 058 | Train 8.8806 | Val 7.7722
[Rect-GD] Epoch 059 | Train 8.8579 | Val 7.8147
[Rect-GD] Epoch 060 | Train 8.8640 | Val 7.7514
[Rect-GD] Epoch 061 | Train 8.8167 | Val 7.8451
[Rect-GD] Epoch 062 | Train 8.8186 | Val 7.6982
[Rect-GD] Epoch 063 | Train 8.8033 | Val 7.7465
[Rect-GD] Epoch 064 | Train 8.7889 | Val 7.7407
[Rect-GD] Epoch 065 | Train 8.7565 | Val 7.7261
[Rect-GD] Epoch 066 | Train 8.7660 | Val 7.7275
[Rect-GD] Epoch 067 | Train 8.7404 | Val 7.6421
[Rect-GD] Epoch 068 | Train 8.7364 | Val 7.6796
[Rect-GD] Epoch 069 | Train 8.7182 | Val 7.6778
[Rect-GD] Epoch 070 | Train 8.7063 | Val 7.6994
[Rect-GD] Epoch 071 | Train 8.7254 | Val 7.6699
[Rect-GD] Epoch 072 | Train 8.7005 | Val 7.6044
[Rect-GD] Epoch 073 | Train 8.7112 | Val 7.6392
[Rect-GD] Epoch 074 | Train 8.6983 | Val 7.6287
[Rect-GD] Epoch 075 | Train 8.7114 | Val 7.6100
[Rect-GD] Epoch 076 | Train 8.6833 | Val 7.6554
[Rect-GD] Epoch 077 | Train 8.6837 | Val 7.5998
[Rect-GD] Epoch 078 | Train 8.6710 | Val 7.6437
[Rect-GD] Epoch 079 | Train 8.6551 | Val 7.6469
[Rect-GD] Epoch 080 | Train 8.6799 | Val 7.5974
[Rect-GD] Epoch 081 | Train 8.6753 | Val 7.5750
[Rect-GD] Epoch 082 | Train 8.6549 | Val 7.6105
[Rect-GD] Epoch 083 | Train 8.6559 | Val 7.6175
[Rect-GD] Epoch 084 | Train 8.6923 | Val 7.5806
[Rect-GD] Epoch 085 | Train 8.6589 | Val 7.5822
[Rect-GD] Epoch 086 | Train 8.6422 | Val 7.5555
[Rect-GD] Epoch 087 | Train 8.6552 | Val 7.5989
[Rect-GD] Epoch 088 | Train 8.6506 | Val 7.6203
[Rect-GD] Epoch 089 | Train 8.6667 | Val 7.5820
[Rect-GD] Epoch 090 | Train 8.6549 | Val 7.5768
[Rect-GD] Epoch 091 | Train 8.6625 | Val 7.5783
[Rect-GD] Early stopping triggered.
[Rect-GD] Best validation total loss: 7.5555
[Rect-GD] Saved training curve plot to results/plots/graph_gdrect_best_7.5555_mimic.png
[Rect-GD] Test recon focal: 0.0352
[Rect-GD] Test Recall@4: 0.0438
[Rect-GD] Test Recall@64: 0.0884
[Rect-GD] Test Recall@adaptiveK: 0.0397
[Rect-GD] Test visit-level Jaccard: 0.0360
[Rect-GD] Diffusion/embedding correlation after training: 0.8591
[Rect-GD] Synthetic stats: {
  "patients": 32,
  "avg_visits_per_patient": 3.78,
  "avg_codes_per_visit": 63.27,
  "max_visits": 5,
  "max_codes": 256
}
Saved checkpoint to results/checkpoints/graph_gdrect_best_7.5555.pt
