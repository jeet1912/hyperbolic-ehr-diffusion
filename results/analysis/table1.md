Using device: mps
[MIMIC] Loading data/mimic_hf_cohort.pkl ...
[MIMIC] Patients: 7397 | Vocab size: 4817
[Rect-GD] Real trajectory stats: {
  "patients": 7397,
  "avg_visits_per_patient": 1.7,
  "avg_codes_per_visit": 424.04,
  "max_visits": 12,
  "max_codes": 9261
}
[Pretrain] Epoch 01 | train=0.0036 | val=0.0034
[Pretrain] Epoch 02 | train=0.0034 | val=0.0031
[Pretrain] Epoch 03 | train=0.0031 | val=0.0029
[Pretrain] Epoch 04 | train=0.0029 | val=0.0027
[Pretrain] Epoch 05 | train=0.0027 | val=0.0026
[Pretrain] Epoch 06 | train=0.0026 | val=0.0025
[Pretrain] Epoch 07 | train=0.0025 | val=0.0024
[Pretrain] Epoch 08 | train=0.0024 | val=0.0023
[Pretrain] Epoch 09 | train=0.0023 | val=0.0023
[Pretrain] Epoch 10 | train=0.0022 | val=0.0022
[Pretrain] Epoch 11 | train=0.0022 | val=0.0022
[Pretrain] Epoch 12 | train=0.0022 | val=0.0022
[Pretrain] Epoch 13 | train=0.0022 | val=0.0022
[Pretrain] Epoch 14 | train=0.0022 | val=0.0022
[Pretrain] Epoch 15 | train=0.0022 | val=0.0022
[Pretrain] Epoch 16 | train=0.0022 | val=0.0022
[Pretrain] Epoch 17 | train=0.0022 | val=0.0022
[Pretrain] Epoch 18 | train=0.0022 | val=0.0022
[Pretrain] Epoch 19 | train=0.0022 | val=0.0022
[Pretrain] Epoch 20 | train=0.0022 | val=0.0021
[Pretrain] Epoch 21 | train=0.0021 | val=0.0021
[Pretrain] Epoch 22 | train=0.0021 | val=0.0021
[Pretrain] Epoch 23 | train=0.0021 | val=0.0021
[Pretrain] Epoch 24 | train=0.0021 | val=0.0021
[Pretrain] Epoch 25 | train=0.0021 | val=0.0021
[Pretrain] Epoch 26 | train=0.0021 | val=0.0021
[Pretrain] Epoch 27 | train=0.0021 | val=0.0021
[Pretrain] Epoch 28 | train=0.0021 | val=0.0021
[Pretrain] Epoch 29 | train=0.0021 | val=0.0021
[Pretrain] Epoch 30 | train=0.0021 | val=0.0021
[Rect-GD] Diffusion/embedding correlation after pretraining: 0.8586
[Rect-GD] Epoch 001 | Train 18.8117 | Val 16.6179
[Rect-GD] Epoch 002 | Train 16.9050 | Val 16.3435
[Rect-GD] Epoch 003 | Train 16.4206 | Val 15.6092
[Rect-GD] Epoch 004 | Train 15.7037 | Val 14.8030
[Rect-GD] Epoch 005 | Train 14.9968 | Val 14.0085
[Rect-GD] Epoch 006 | Train 14.3884 | Val 13.4289
[Rect-GD] Epoch 007 | Train 13.8778 | Val 12.7984
[Rect-GD] Epoch 008 | Train 13.4807 | Val 12.4632
[Rect-GD] Epoch 009 | Train 13.1214 | Val 12.0358
[Rect-GD] Epoch 010 | Train 12.7506 | Val 11.6782
[Rect-GD] Epoch 011 | Train 12.4777 | Val 11.4123
[Rect-GD] Epoch 012 | Train 12.2032 | Val 11.1756
[Rect-GD] Epoch 013 | Train 11.9680 | Val 10.8660
[Rect-GD] Epoch 014 | Train 11.7612 | Val 10.6141
[Rect-GD] Epoch 015 | Train 11.5528 | Val 10.4138
[Rect-GD] Epoch 016 | Train 11.4318 | Val 10.3864
[Rect-GD] Epoch 017 | Train 11.1940 | Val 10.1399
[Rect-GD] Epoch 018 | Train 11.0974 | Val 9.8424
[Rect-GD] Epoch 019 | Train 10.9206 | Val 9.7566
[Rect-GD] Epoch 020 | Train 10.7443 | Val 9.6789
[Rect-GD] Epoch 021 | Train 10.6616 | Val 9.5400
[Rect-GD] Epoch 022 | Train 10.5393 | Val 9.3902
[Rect-GD] Epoch 023 | Train 10.3743 | Val 9.3005
[Rect-GD] Epoch 024 | Train 10.2651 | Val 9.1542
[Rect-GD] Epoch 025 | Train 10.1776 | Val 9.0523
[Rect-GD] Epoch 026 | Train 10.0827 | Val 8.9767
[Rect-GD] Epoch 027 | Train 10.0133 | Val 8.8510
[Rect-GD] Epoch 028 | Train 9.9429 | Val 8.8012
[Rect-GD] Epoch 029 | Train 9.8523 | Val 8.7290
[Rect-GD] Epoch 030 | Train 9.7845 | Val 8.6286
[Rect-GD] Epoch 031 | Train 9.7289 | Val 8.6600
[Rect-GD] Epoch 032 | Train 9.6851 | Val 8.4965
[Rect-GD] Epoch 033 | Train 9.6275 | Val 8.4532
[Rect-GD] Epoch 034 | Train 9.5665 | Val 8.4785
[Rect-GD] Epoch 035 | Train 9.5079 | Val 8.4551
[Rect-GD] Epoch 036 | Train 9.4428 | Val 8.2953
[Rect-GD] Epoch 037 | Train 9.4188 | Val 8.3256
[Rect-GD] Epoch 038 | Train 9.3688 | Val 8.2339
[Rect-GD] Epoch 039 | Train 9.3280 | Val 8.1800
[Rect-GD] Epoch 040 | Train 9.3081 | Val 8.2205
[Rect-GD] Epoch 041 | Train 9.2652 | Val 8.1660
[Rect-GD] Epoch 042 | Train 9.2288 | Val 8.0876
[Rect-GD] Epoch 043 | Train 9.2111 | Val 8.0882
[Rect-GD] Epoch 044 | Train 9.1294 | Val 8.0417
[Rect-GD] Epoch 045 | Train 9.1283 | Val 8.0387
[Rect-GD] Epoch 046 | Train 9.1224 | Val 8.0361
[Rect-GD] Epoch 047 | Train 9.0953 | Val 7.9974
[Rect-GD] Epoch 048 | Train 9.0736 | Val 8.0432
[Rect-GD] Epoch 049 | Train 9.0302 | Val 8.0148
[Rect-GD] Epoch 050 | Train 8.9933 | Val 7.9285
[Rect-GD] Epoch 051 | Train 9.0200 | Val 7.9872
[Rect-GD] Epoch 052 | Train 8.9846 | Val 7.9169
[Rect-GD] Epoch 053 | Train 8.9611 | Val 7.8340
[Rect-GD] Epoch 054 | Train 8.9480 | Val 7.8832
[Rect-GD] Epoch 055 | Train 8.9517 | Val 7.8733
[Rect-GD] Epoch 056 | Train 8.8964 | Val 7.7979
[Rect-GD] Epoch 057 | Train 8.9075 | Val 7.8405
[Rect-GD] Epoch 058 | Train 8.8794 | Val 7.8224
[Rect-GD] Epoch 059 | Train 8.8516 | Val 7.7899
[Rect-GD] Epoch 060 | Train 8.8592 | Val 7.7929
[Rect-GD] Epoch 061 | Train 8.8457 | Val 7.7609
[Rect-GD] Epoch 062 | Train 8.8054 | Val 7.7898
[Rect-GD] Epoch 063 | Train 8.8129 | Val 7.7445
[Rect-GD] Epoch 064 | Train 8.7975 | Val 7.7875
[Rect-GD] Epoch 065 | Train 8.8272 | Val 7.7510
[Rect-GD] Epoch 066 | Train 8.8004 | Val 7.7637
[Rect-GD] Epoch 067 | Train 8.7561 | Val 7.7069
[Rect-GD] Epoch 068 | Train 8.7695 | Val 7.6911
[Rect-GD] Epoch 069 | Train 8.7468 | Val 7.6947
[Rect-GD] Epoch 070 | Train 8.7530 | Val 7.7093
[Rect-GD] Epoch 071 | Train 8.7364 | Val 7.6962
[Rect-GD] Epoch 072 | Train 8.7489 | Val 7.7290
[Rect-GD] Epoch 073 | Train 8.7306 | Val 7.6381
[Rect-GD] Epoch 074 | Train 8.7318 | Val 7.6263
[Rect-GD] Epoch 075 | Train 8.7157 | Val 7.6604
[Rect-GD] Epoch 076 | Train 8.7138 | Val 7.6804
[Rect-GD] Epoch 077 | Train 8.7211 | Val 7.6458
[Rect-GD] Epoch 078 | Train 8.6877 | Val 7.6681
[Rect-GD] Epoch 079 | Train 8.7040 | Val 7.6821
[Rect-GD] Early stopping triggered.
[Rect-GD] Best validation total loss: 7.6263
[Rect-GD] Saved training curve plot to results/plots/graph_gdrect_best_7.6263_mimic.png
[Rect-GD] Test recon focal: 0.0352
[Rect-GD] Test Recall@4: 0.0246
[Rect-GD] Diffusion/embedding correlation after training: 0.8569
[Rect-GD] Synthetic stats: {
  "patients": 32,
  "avg_visits_per_patient": 3.5,
  "avg_codes_per_visit": 1.0,
  "max_visits": 5,
  "max_codes": 1
}
Saved checkpoint to results/checkpoints/graph_gdrect_best_7.6263.pt
